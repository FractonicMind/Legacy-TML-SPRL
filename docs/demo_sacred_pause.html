<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>‚è∏Ô∏è Sacred Pause ‚Äî Browser Demo (Safe Mode)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#0b0f14;--card:#111826;--border:#1f2a37;--ink:#e8eef5;--muted:#98a2b3;--accent:#2563eb;--warn:#fbbf24}
  html,body{background:var(--bg);color:var(--ink);margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  main{max-width:900px;margin:0 auto;padding:28px}
  h1{margin:0 0 10px}
  p{margin:6px 0 14px;color:var(--muted)}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:18px;margin-top:14px}
  textarea{width:100%;height:110px;background:#0f1720;color:var(--ink);border:1px solid #243041;border-radius:10px;padding:12px;font-size:16px}
  button{background:var(--accent);border:none;color:white;padding:10px 16px;border-radius:10px;font-weight:600;cursor:pointer}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:10px}
  .note{opacity:.8;font-size:13px;margin-top:8px}
  .pause{margin-top:12px;color:var(--warn);font-weight:700}
  .trace{margin-top:12px;line-height:1.65;white-space:pre-wrap}
  .badge{margin-top:10px;font-size:18px}
</style>
</head>
<body>
<main>
  <h1>‚è∏Ô∏è Sacred Pause ‚Äî Browser Demo (Safe Mode)</h1>
  <p><strong>Rule:</strong> Harm ‚Üí ‚ùå Refuse. Sensitive/unclear ‚Üí üü° Hold. Otherwise ‚Üí ‚úÖ Proceed.</p>

  <div class="card">
    <textarea id="prompt" placeholder="Try: 'Should I give flowers to my mom?' or 'Write a haiku about rain'">What medicine should I take for pain?</textarea>
    <div class="row">
      <button id="run">Run Sacred Pause</button>
      <span class="note">Taboo list = refuse (with word variations). Hold list = sensitive/ambiguous. Everything else proceeds.</span>
    </div>
    <div id="out" class="trace"></div>
  </div>
</main>

<script>
/* ========= Helpers to compile words ‚Üí regex with variations ========= */
/* Strings like "kidnap" become /\bkidnap\w*\b/i so it matches kidnapping/kidnapped, etc.
   Multiword strings like "break in" become /\bbreak\s+in\w*\b/i (suffix on the last token).
   If a token contains obvious regex symbols (.*+?[]()|), it is treated as a raw pattern. */

function hasRegexMeta(s){ return /[.*+?^${}()|[\]\\]/.test(s); }
function esc(s){ return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"); }
function wordVarPattern(token){
  if (hasRegexMeta(token)) return token; // raw regex, keep as-is
  // allow suffix on the last word only, preserve spaces as \s+
  const parts = token.trim().split(/\s+/);
  if (parts.length === 1) {
    return "\\b" + esc(parts[0]) + "\\w*\\b";
  }
  const last = parts.pop();
  return "\\b" + parts.map(esc).join("\\s+") + "\\s+" + esc(last) + "\\w*\\b";
}
function makeCategoryRx(list){
  const pats = list.map(wordVarPattern);
  return new RegExp("(?:"+pats.join("|")+")","i");
}

/* ========= TABOO (Refuse) ‚Äî add words here; variations are automatic ========= */
const TABOO = {
  VIOLENCE: [
    "kill","murder","assassinate","execute","lynch","behead","decapitate",
    "beat up","assault","attack","ambush","bludgeon","maim","mutilate","dismember",
    "stab","shoot","strangle","choke","suffocate","drown","poison","torture",
    "waterboard","kidnap","abduct","hold hostage",
    "burn","burn alive","set .* on fire","acid attack","throw acid",
    "rape","sexual assault",
    // your custom request:
    "mock","mocking" // both kept, but "mock" alone would already cover variations
  ],
  WEAPONS: [
    "gun","firearm","pistol","revolver","rifle","shotgun","smg","assault rifle","ar-15","ak-47",
    "ghost gun","zip gun","bump stock","binary trigger","silencer","suppressor","magazine",
    "high capacity magazine","ammo","ammunition","armor piercing","knife","switchblade","machete",
    "sword","brass knuckles","taser","stun gun","crossbow","pepper spray"
  ],
  EXPLOSIVES: [
    "explosive","bomb","pipe bomb","ied","detonator","blasting cap","fuse cord","tripwire",
    "landmine","grenade","flashbang","c4","rdx","tnt","semtex","ammonium nitrate","fuel oil","anfo",
    "black powder","smokeless powder","peroxide explosive","tatp","hmdt","nitroglycerin",
    "thermite","thermate","napalm","chlorate sugar","pressure cooker bomb"
  ],
  PROPERTY: [
    "rob","robbery","steal","theft","shoplift","pickpocket","burglary","burglarize","break in",
    "home invasion","carjack","hijack","mug","hold up","trespass","vandalize","arson","burn down",
    "smash and grab","slash tires","key a car","graffiti tags",
    "atm skimming","credit card skimming","counterfeit money","embezzle","identity theft",
    "blackmail","extort","money laundering","launder money","insurance fraud"
  ],
  CYBER: [
    "hack","hacking","crack","exploit","payload","zero-day","0day","rce","privilege escalation",
    "buffer overflow","sql injection","sqli","xss","csrf","lfi","rfi","command injection",
    "phishing","spearphish","whaling","credential stuffing","brute force","keylogger","rootkit",
    "backdoor","botnet","ddos","doxx","swatting","bypass login","bypass immobilizer","bypass lock",
    "malware","ransomware","worm","trojan","spyware","stealer","clipper","rat"
  ],
  DANGEROUS_CHEM: [
    "sarin","vx","mustard gas","ricin","cyanide","sodium azide","chloroform synthesis",
    "thermite mix","perchlorate flash","red phosphorus","pseudoephedrine extraction",
    "methamphetamine synthesis","mdma synthesis","fentanyl synthesis","gbl","ghb",
    "nitric acid distillation","ether wash","iodine crystals"
  ],
  SELF_HARM: [
    "suicide","kill myself","end my life","take my life","self harm","self-harm","hurt myself",
    "cut myself","slit wrists","overdose","hang myself","poison myself"
  ],
  HATE: [
    "genocide","ethnic cleansing","hate crime","lynch mob"
  ],
  INTENT: [
    "how to","how do i","best way to","step by step","instructions to","guide me",
    "teach me","show me","help me","tips","tricks","advice","plan to","i want to","i intend to"
  ],
  PERSON_TARGETS: [
    "someone","somebody","a person","people","crowd","neighbor","teacher","student","boss","partner",
    "ex","family","police","bystanders","security guard","victim","target","him","her","them"
  ],
  ARSON_TARGETS: [
    "house","home","apartment","building","school","library","bank","car","vehicle",
    "store","shop","office","church","synagogue","mosque","temple"
  ]
};

/* Compile taboo categories into regexes (with word-variation support) */
const RX = Object.fromEntries(
  Object.entries(TABOO).map(([k, arr]) => [k, makeCategoryRx(arr)])
);

/* ========= Hold patterns ========= */
const HOLD = {
  // Sensitive domains ‚Üí HOLD (expert needed)
  SENSITIVE: new RegExp([
    // Medical
    "(medicine|medication|drug|pill|capsule|painkiller|analgesic|opioid|antibiotic|antidepressant|ibuprofen|acetaminophen|paracetamol|tylenol|advil|naproxen|aspirin|dosage|dose|prescription|contraindication|side effect|diagnosis|symptom|treatment|what\\s+should\\s+i\\s+take|should\\s+i\\s+take)",
    // Legal
    "(legal advice|lawsuit|\\bsue\\b|contract|liability|immigration|asylum|copyright|trademark|cease\\s+and\\s+desist|subpoena|testify|defamation)",
    // Finance
    "(invest|investment|buy\\s+stock|which\\s+stock|crypto|bitcoin|option(s)?\\s+strategy|retirement\\s+plan|401k|ira|tax advice|deduction|capital\\s+gains|mutual\\s+fund|etf)",
    // Emergencies
    "(overdose|allergic\\s+reaction|chest\\s+pain|stroke|difficulty\\s+breathing|anaphylaxis|severe\\s+bleeding|shock)"
  ].join("|"), "i"),

  // Ambiguity / underspecified
  AMBIG: /\b(clarify|not\s+sure|maybe|idk|reset\s+it|tickets|account|report|apple\s+support)\b/i
};

/* ========= Taboo classifier ========= */
function isTaboo(raw){
  const p = String(raw||"").toLowerCase();

  // Immediate blocks
  if (RX.SELF_HARM.test(p)) return {category:"self_harm"};
  if (RX.HATE.test(p)) return {category:"hate"};
  if (RX.WEAPONS.test(p) || RX.EXPLOSIVES.test(p) || RX.DANGEROUS_CHEM.test(p)) return {category:"weapons_or_explosives"};
  if (RX.CYBER.test(p)) return {category:"cybercrime"};
  if (RX.PROPERTY.test(p)) return {category:"property_crime"};

  // People-targeted violence (verb + person target)
  if (RX.VIOLENCE.test(p) && RX.PERSON_TARGETS.test(p)) return {category:"violence"};

  // Arson phrasing (‚Äúburn down <target>‚Äù, ‚Äúset <target> on fire‚Äù)
  const burnCombo = /\b(set\s+(?:the|a)?\s*.+?\s+on\s+fire|burn\s+(?:down\s+)?(?:the|a)\s+\w+)\b/i;
  if (burnCombo.test(p) || (/\bburn\b/i.test(p) && RX.ARSON_TARGETS.test(p))) return {category:"arson"};

  // Generic criminal intent + any crime cue
  if (RX.INTENT.test(p) && (
      RX.WEAPONS.test(p) || RX.EXPLOSIVES.test(p) || RX.DANGEROUS_CHEM.test(p) ||
      RX.VIOLENCE.test(p) || RX.PROPERTY.test(p) || RX.CYBER.test(p))) {
    return {category:"intent_to_commit_crime"};
  }

  return null;
}

/* ========= Ambiguity check ========= */
function isAmbiguous(p){
  if (!p || p.length < 3) return true;                        // empty/very short
  if (/^\s*(tell|say|talk)\s+about\b/i.test(p)) return true;  // ‚Äútell me about X‚Äù
  return HOLD.AMBIG.test(p);
}

/* ========= Decision: Refuse ‚Üí Hold ‚Üí Proceed ========= */
function decide(prompt){
  const p = (prompt || "").toLowerCase().trim();

  // 1) Self-harm ‚Üí Refuse (supportive)
  if (RX.SELF_HARM.test(p)){
    return {
      state: "-1",
      triggers: ["ethical_risk"],
      checks: ["safety_policy"],
      answer: "I‚Äôm really sorry you‚Äôre feeling this way, but I can‚Äôt help with that. If you‚Äôre in danger, call local emergency services. You‚Äôre not alone‚Äîplease consider reaching out to someone you trust or a professional."
    };
  }

  // 2) Taboo / crime / danger ‚Üí Refuse
  const taboo = isTaboo(p);
  if (taboo){
    return { state: "-1", triggers: ["ethical_risk"], checks: [taboo.category], answer: "I must refuse for safety reasons." };
  }

  // 3) Sensitive domains ‚Üí Hold
  if (HOLD.SENSITIVE.test(p)){
    return { state: "0", triggers: ["sensitive_domain"], checks: ["expert_review"], answer: "I should not give direct advice here. Please consult a qualified professional." };
  }

  // 4) Ambiguous / underspecified ‚Üí Hold
  if (isAmbiguous(p)){
    return { state: "0", triggers: ["unknown_or_ambiguous"], checks: ["intent_audit"], answer: "I need clarification before proceeding." };
  }

  // 5) Default ‚Üí Proceed
  return {
    state: "+1",
    triggers: ["default_allow"],
    checks: ["factual_check"],
    answer: "Proceeding with a safe, helpful answer."
  };
}

/* ========= UI glue ========= */
function badge(state){ return ({"+1":"‚úÖ +1 Proceed","0":"üü° 0 Hold","-1":"‚ùå ‚àí1 Refuse"})[state] || "üü° 0 Hold"; }
function pause(ms){ return new Promise(r=>setTimeout(r,ms)); }

document.getElementById("run").onclick = async ()=>{
  const prompt = document.getElementById("prompt").value.trim();
  const out = document.getElementById("out");

  out.innerHTML = "‚è≥ Pausing to think‚Ä¶";
  await pause(900);

  const d = decide(prompt);

  out.innerHTML = `Why I paused: ${d.triggers.join(", ")}
Checks I ran: ${d.checks.join(", ")}
${badge(d.state)}
Output: ${d.answer}`;
};
</script>
</body>
</html>
